## Графы

Граф — структура данных, которая состоит из набора элементов и связей между ними.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_06_graf_1_1602760519.png)

_Граф_

Элементы называются вершинами графа (vertices), а связи между вершинам — рёбрами (edges). Каждая вершина хранит любые нужные данные. Вершины, соединённые одним ребром, называются смежными.

Граф может иметь висячие вершины и участки, не соединённые с другими участками:

![image](https://pictures.s3.yandex.net/resources/S5_04.6_07_graf_1_1602760535.png)

_Графы с висячими вершинами_

С помощью графа моделируют любые связи между сущностями. На схеме ниже мы отобразили людей и фильмы, которые им понравились. На основании этого можно найти людей со схожими интересами и рекомендовать им любимые фильмы друг друга.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_08_graf_1_1602760573.png)

_Граф, отображающий понравившиеся Пете, Ване и Свете фильмы_

У Пети больше общих интересов с Ваней, чем со Светой. Ему можно порекомендовать из списка Вани фильм Бойцовский клуб.

В предыдущих уроках вы изучили деревья. Дерево — частный случай графа. Основное отличие в том, что в дереве отсутствуют связи между дочерними элементами, а в графе связи могут быть между любыми элементами. Кроме того, у дерева есть корень — вершина, с которой мы начинаем обход дерева. С вершины можно добраться до остальных элементов дерева. У графа такой точки нет, все его вершины равнозначны.

## Типы графов

**Неориентированный граф** — тот, у рёбер которого нет направления, они просто соединяют две вершины, или сущности. Например, на схеме ниже люди — вершины, а рёбра между ними — признак, что эти люди знают друг друга. Такое представление можно использовать в социальных сетях для моделирования связей между пользователями.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_09_graf_1_1602760603.png)

_Неориентированный граф_

**Ориентированный граф** — тот, у рёбер которого есть направление. К примеру, люди — вершины, а рёбра между ними указывают на их подписки. Маша подписана на Ваню, а Ваня подписан на Свету.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_10_graf_1_1602760628.png)

_Ориентированный граф_

**Взвешенный** **граф** — тот, у которого каждое ребро имеет какое-то число. Это число — вес ребра. На схеме ниже вершины — города, а вес ребра обозначает расстояние между ними в километрах.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_11_graf_1_1602760659.png)

_Взвешенный граф_

Граф может быть одновременно взвешенным и ориентированным. Изобразим Золотое кольцо России в виде графа. Вершины — города, вес рёбер — расстояние между ними, а направление указывает маршрут Золотого кольца.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_12_graf_1_1602760682.png)

_Ориентированный взвешенный граф_

## Представление графа

Два основных способа представить граф — матрица смежности (adjacency matrix) и список смежности (adjacency list).

**Матрица смежности** представляет граф как двумерный массив:

![image](https://pictures.s3.yandex.net/resources/S5_04.6_13_graf_1_1602760709.png)

_Представление графа с помощью матрицы смежности_

Значения матрицы — признак наличия или отсутствия связи между вершинами. В матрице используют нули и единицы или булевы значения. Матрицу хранят как в массиве, так и в хеш-таблице.

Для неориентированного графа матрица будет симметричной за счёт того, что связь `A` c `B` равносильна связи `B` c `A`. Для ориентированного — несимметричной.

В матрице смежности можно быстро проверить наличие связи между двумя вершинами, добавить или удалить ребро между ними. Сложность всех этих операций `О(1)`.

Чтобы создать вершину, нужно добавить новое значение в каждый массив. Сложность добавления элемента в массив –– `О(n)`. В матрице смежности всего `n+1` массивов, где один внешний и `n` внутренних. Поэтому общая сложность операции добавления –– `О(n*(n+1)) = О(n^2)`.

Чтобы удалить вершину, нужно сделать это в каждом массиве. Сложность удаления элемента из массива — `O(n)`, а общая сложность этой операции — `О(n^2)`.

Пространственная сложность матрицы смежности — `О(n^2)`, поскольку для каждой вершины нужно заводить отдельный массив размера `n`.

**Список смежности** представляет граф как список вершин. С каждой вершиной хранится список вершин, смежных с ней.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_14_graf_1_1602760735.png)

_Представление графа с помощью списка смежности_

Список смежности реализуют с применением связных списков. В одном списке хранят вершины. Каждая вершина имеет ещё `n` списков, в которых хранят рёбра.

Иногда для хранения вершин используют хеш-таблицу, а для хранения рёбер — массив:

Список смежности позволяет быстро добавлять вершины и рёбра — нужно просто поставить новый элемент в конец списка. Эта операция занимает `О(1)` — одинаково для списка и хеш-таблицы.

Чтобы удалить элемент, нужно линейно пройти по списку с вершинами и вложенному списку смежных вершин. Операция удаления из связного списка занимает `О(1)`. Общая сложность — `О(v+e)`, где `v` — количество вершин в графе, ведь придётся пройти по списку с вершинами, и `e` — число рёбер, так как нужно пройти по вложенным спискам с общим количеством элементов, равным числу рёбер в графе.

Сложность удаления вершины можно уменьшить до `O(e)`, применив хеш-таблицу. Тогда не нужно идти по всему списку вершин, достаточно обратиться к искомой по ключу за `О(1)`.

Удаление ребра между вершинами требует прохода по списку вершин и двух проходов по списку рёбер. Максимальное число рёбер, которое имеет одна вершина — `v-1`. Поэтому общая сложность удаления ребра — `О(v + 2*(v - 1)) = O(v)`.

В хеш-таблице сложность операции удаления грани такая же, хотя фактически она происходит быстрее, потому что не нужно обходить список с вершинами.

Пространственная сложность списка смежности — `О(v + e)`, ведь мы храним список всех вершин и рёбер.

Если данные разреженные — вершин больше, чем связей между ними, лучше представлять граф в виде списка смежностей. Такое характерно для больших данных.

![image](https://pictures.s3.yandex.net/resources/S5_04.6_14_table_1_1602760758.png)